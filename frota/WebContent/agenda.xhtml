<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:p="http://primefaces.org/ui">

<ui:composition template="/template/main.xhtml">

	<f:metadata>
		<f:viewParam name="agendaId" value="#{agendaBean.agendaId}" />
		<f:viewAction action="#{agendaBean.recuperarAgendaPorId}"
			if="#{param.agendaId != null}" />
	</f:metadata>

	<ui:define name="content">

		<f:view>
			<h1>Agendamentos</h1>

			<p:messages id="messages" globalOnly="true" />

			<p:fieldset legend="Dados do Agendamento" id="fieldAgenda">
				<h:inputHidden value="#{agendaBean.usuarioId}" />
				<h:form id="formAgendaBusca" styleClass="linha">
					<h:outputLabel value="Solicitante: " for="nome" styleClass="ui-g-4">
						<h:inputText id="nome" value="#{usuarioBean.usuarioNome}"
							required="true" requiredMessage="Nome do Usuario obrigatório"
							validatorMessage="Nome do Usuario deve ter no minimo 2 caracteres"
							styleClass="ui-g-12">
							<f:validateLength maximum="30" minimum="2" />
							<f:ajax execute="@form"
								render="@form :tabelaUsuarios :fieldAgenda" />
						</h:inputText>
					</h:outputLabel>

					<h:outputLabel value="Setor: " for="setorId" styleClass="ui-g-3">
						<h:selectOneMenu value="#{usuarioBean.setorId}" id="setorId"
							styleClass="ui-g-12">
							<f:selectItem itemValue="" itemLabel="Escolha um Setor" />
							<f:selectItems value="#{setorBean.setores}" var="setor"
								itemLabel="#{setor.nome}" itemValue="#{setor.id}" />
							<f:ajax execute="@form"
								render="@form :tabelaUsuarios :fieldAgenda" />
						</h:selectOneMenu>
					</h:outputLabel>

					<h:outputLabel styleClass="ui-g-2">
						<h:commandButton value="Buscar Solicitante"
							action="#{usuarioBean.listar}" styleClass="ui-g-12 botao">
							<f:ajax execute="@form"
								render="@form :tabelaUsuarios :fieldAgenda" />
						</h:commandButton>
					</h:outputLabel>
				</h:form>

				<h:form id="tabelaUsuarios" styleClass="ui-g-12 tabela"
					rendered="#{(usuarioBean.usuarioNome != usuarioBean.usuario.nome) and (usuarioBean.usuarioNome != '' )}">
					<p:dataTable var="usuario" value="#{usuarioBean.usuarios}">
						<p:column headerText="Nome">
							<h:outputText value="#{usuario.nome}" />
						</p:column>
						<p:column headerText="CPF">
							<h:outputText value="#{usuario.cpf}" />
						</p:column>
						<p:column headerText="Setor">
							<h:outputText value="#{usuario.setor.nome}" />
						</p:column>
						<p:column headerText="Telefone">
							<h:outputText value="#{usuario.fone}" />
						</p:column>
						<p:column headerText="Carregar">
							<h:commandButton styleClass="ui-g-12" value="Carregar"
								action="#{agendaBean.carregarUsuario(usuario)}"
								actionListener="#{usuarioBean.carregarUsuario(usuario)}">
							</h:commandButton>
						</p:column>
					</p:dataTable>
				</h:form>

				<h:form id="formAgendaCadastro" styleClass="container">
					<div class="container">
						<div class="linha">
							<h:outputLabel value="Data de Saida:" for="dataSaida"
								styleClass="ui-g-1" />
							<h:inputText id="dataSaida"
								value="#{agendaBean.agenda.dataSaida.time}" required="true"
								requiredMessage="Data de Saida Obrigatória" maxlength="10"
								styleClass="ui-g-2">
								<f:convertDateTime pattern="dd/MM/yyyy"
									timeZone="America/Sao_Paulo" />
								<f:ajax event="blur" render="messagens" />
							</h:inputText>

							<h:outputLabel value="Hora de Saida:" for="horaSaida"
								styleClass="ui-g-1" />
							<h:inputText id="horaSaida"
								value="#{agendaBean.agenda.horaSaida}" required="true"
								requiredMessage="Hora de Saida Obrigatória" maxlength="5"
								styleClass="ui-g-1">
								<f:ajax event="blur" render="horaSaidaMessage" />
							</h:inputText>
							<p:message for="horaSaida" id="horaSaidaMessage"
								styleClass="ui-g-3" />
						</div>

						<div class="linha">
							<h:outputLabel value="Data de Chegada:" for="dataChegada"
								styleClass="ui-g-1" />
							<h:inputText id="dataChegada"
								value="#{agendaBean.agenda.dataChegada.time}" required="true"
								requiredMessage="Data de Chegada Obrigatória" maxlength="10"
								styleClass="ui-g-2">
								<f:convertDateTime pattern="dd/MM/yyyy"
									timeZone="America/Sao_Paulo" />
								<f:ajax event="blur" render="messagens" />
							</h:inputText>

							<h:outputLabel value="Hora de Chegada:" for="horaChegada"
								styleClass="ui-g-1" />
							<h:inputText id="horaChegada"
								value="#{agendaBean.agenda.horaChegada}" required="true"
								requiredMessage="Hora de Chegada Obrigatória" maxlength="5"
								styleClass="ui-g-1">
								<f:ajax event="blur" render="horaChegadaMessage" />
							</h:inputText>
							<p:message for="horaChegada" id="horaChegadaMessage"
								styleClass="ui-g-3" />
						</div>
					</div>


					<div class="container">
						<div class="linha">
							<h:outputLabel value="Tipo de Veiculo:" for="tipo"
								styleClass="ui-g-1" />
							<h:selectOneMenu value="#{agendaBean.agenda.tipoVeiculo}"
								id="tipo" required="true"
								requiredMessage="Tipo de Veiculo obrigatório"
								styleClass="ui-g-3">
								<c:choose>
									<c:when test="#{agendaBean.agenda.tipoVeiculo == null}">
										<f:selectItem itemValue=""
											itemLabel="Escolha um Tipo de Veiculo" />
									</c:when>
								</c:choose>
								<f:selectItems value="#{veiculoBean.tipoVeiculo}" var="tipo"
									itemLabel="#{tipo.label}" itemValue="#{tipo}" />
								<f:ajax event="blur" render="tipoMessage" />
							</h:selectOneMenu>
							<p:message for="tipo" id="tipoMessage" styleClass="ui-g-4" />
						</div>

						<div class="linha">
							<h:outputLabel value="Destino:" for="destino" styleClass="ui-g-1" />
							<h:inputText id="destino" value="#{agendaBean.agenda.destino}"
								required="true"
								requiredMessage="Descrição do Destino Obrigatória"
								styleClass="ui-g-3">
								<f:ajax event="blur" render="destinoMessage" />
							</h:inputText>
							<p:message for="destino" id="destinoMessage" styleClass="ui-g-4" />
						</div>

						<div class="linha">
							<h:outputLabel value="Observações:" for="descricao"
								styleClass="ui-g-1" />
							<h:inputTextarea id="descricao"
								value="#{agendaBean.agenda.descricao}" styleClass="ui-g-6"
								rows="3" />
						</div>
					</div>


					<h:outputLabel styleClass="ui-g-2">
						<h:commandButton value="Gravar" action="#{agendaBean.gravar}"
							styleClass="ui-g-12 botao">
						</h:commandButton>
					</h:outputLabel>
				</h:form>
			</p:fieldset>
		</f:view>
	</ui:define>
</ui:composition>
</html>
